{% extends "layout.html" %}
{% block body %}
  <div class="d-flex align-items-center justify-content-between mb-3 flex-wrap gap-2">
    <div>
      <h1 class="h3 mb-0">SpiderFoot OSINT</h1>
      <p class="text-muted mb-0">Pivot across IPs, domains, identities, and crypto footprints with SpiderFoot CLI.</p>
    </div>
    <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">← Back to quick scans</a>
  </div>

  <div class="card shadow-sm">
    <div class="card-header fw-semibold">Search targets</div>
    <div class="card-body">
      <form method="post" action="{{ url_for('spiderfoot_console') }}" class="vstack gap-3">
        <div class="row g-3">
          <div class="col-12 col-lg-4">
            <label class="form-label" for="targetType">What are you searching?</label>
            <select id="targetType" name="target_type" class="form-select" required>
              {% for t in lookup_types %}
                <option value="{{ t.value }}" {% if t.value == target_type %}selected{% endif %}>{{ t.label }}</option>
              {% endfor %}
            </select>
            <div class="form-text">SpiderFoot will auto-detect appropriate modules for the chosen target.</div>
          </div>
          <div class="col-12 col-lg-8">
            <label class="form-label" for="targetValue">Target value</label>
            <input id="targetValue" class="form-control" name="target_value" placeholder="IP, domain, username, or hash" value="{{ target_value }}" required>
            <div class="form-text">Examples: {{ lookup_types | map(attribute='example') | list | join(', ') }}</div>
          </div>
        </div>

        <div class="row g-3">
          <div class="col-12 col-lg-6">
            <label class="form-label" for="spiderModules">SpiderFoot modules (optional)</label>
            <input id="spiderModules" class="form-control" name="spiderfoot_modules" placeholder="e.g. sfp_dnsresolve,sfp_shodan" value="{{ modules_raw }}">
            <div class="form-text">Leave blank for SpiderFoot defaults, or restrict to specific modules.</div>
          </div>
          <div class="col-12 col-lg-6">
            <label class="form-label" for="sfUser">Operator</label>
            <input id="sfUser" class="form-control" name="user" placeholder="Your name or initials" value="{{ user }}">
          </div>
        </div>

        <div class="d-flex flex-wrap gap-2 align-items-center">
          <button class="btn btn-primary">Run SpiderFoot</button>
          <span class="text-muted2 small">GUI-like lookups via the CLI runner. Expect longer runs for broad modules.</span>
        </div>
      </form>
    </div>
  </div>

  <div class="row g-3 mt-3">
    <div class="col-12 col-xl-8">
      {% if result %}
        <div class="card shadow-sm">
          <div class="card-header fw-semibold">Scan output</div>
          <div class="card-body">
            <p class="text-muted small mb-2">Return code: {{ result.returncode }} · Started: {{ result.started_at }} · Finished: {{ result.finished_at }}</p>
            <h6>Stdout</h6>
            <pre class="result-pre bg-body-tertiary p-3 rounded">{{ result.stdout or 'No stdout captured.' }}</pre>
            <h6>Stderr</h6>
            <pre class="result-pre bg-body-tertiary p-3 rounded">{{ result.stderr or 'No stderr captured.' }}</pre>
          </div>
        </div>
      {% else %}
        <div class="card shadow-sm h-100">
          <div class="card-body d-flex flex-column justify-content-center text-center text-muted">
            <p class="mb-1">Run a SpiderFoot lookup to see enriched OSINT results here.</p>
            <p class="mb-0 small">Supported: IPs, domains, hostnames, CIDRs, ASNs, email addresses, phone numbers, usernames, names, Bitcoin addresses.</p>
          </div>
        </div>
      {% endif %}
    </div>

    <div class="col-12 col-xl-4">
      <div class="card shadow-sm">
        <div class="card-header fw-semibold">Tips</div>
        <div class="card-body small text-muted">
          <ul class="mb-3">
            <li>For scoped OSINT, keep module list tight to avoid third-party calls that need API keys.</li>
            <li>Domains and IPs will automatically trigger DNS, network, breach, and reputation modules.</li>
            <li>Use CIDR to sweep infrastructure ranges; ASN to map provider-owned space.</li>
            <li>People and usernames lean on breach corpuses and social footprint modules.</li>
            <li>Crypto searches work best with Bitcoin base58 addresses.</li>
          </ul>
          <p class="mb-1">Looking for the original multi-tool suite? <a href="{{ url_for('index') }}">Go back to App/API + supply chain.</a></p>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
